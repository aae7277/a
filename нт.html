<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ü–æ–≥–æ–¥–∞ –∏ –í—Ä–µ–º—è</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      color: white;
      text-align: center;
      min-height: 100vh;
      overflow-x: hidden;
      background: linear-gradient(-45deg, #0f2027, #203a43, #2c5364, #1a1a2e);
      background-size: 400% 400%;
      animation: animateBG 30s ease infinite;
    }

    @keyframes animateBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .box {
      background: rgba(0,0,0,0.5);
      margin: 40px auto;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 0 20px #000;
      max-width: 600px;
    }

    h1 { margin-bottom: 10px; }
    .value { font-size: 1.6em; margin-top: 10px; }

    #icon {
      font-size: 3em;
      margin: 15px;
    }

    canvas {
      max-width: 100%;
      margin-top: 20px;
    }

    .forecast-text {
      margin-top: 20px;
      font-size: 1.1em;
      color: #ddd;
    }

    footer {
      position: fixed;
      bottom: 10px;
      width: 100%;
      text-align: center;
      font-size: 1em;
      color: #ccc;
      font-style: italic;
      animation: flicker 3s infinite;
    }

    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .snowflake {
      position: fixed;
      top: -10px;
      color: white;
      font-size: 1.2em;
      animation: fall linear infinite;
    }

    @keyframes fall {
      0% { transform: translateY(-10px); }
      100% { transform: translateY(100vh); }
    }

    .shake {
      animation: shake 0.2s infinite;
    }

    @keyframes shake {
      0% { transform: translate(0px, 0px); }
      25% { transform: translate(2px, -2px); }
      50% { transform: translate(-2px, 2px); }
      75% { transform: translate(2px, 2px); }
      100% { transform: translate(-2px, -2px); }
    }

    iframe.map {
      margin-top: 30px;
      width: 100%;
      max-width: 1000px;
      height: 500px;
      border: none;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>

  <div class="box">
    <h1>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</h1>
    <div id="time" class="value">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <h1>–ü–æ–≥–æ–¥–∞</h1>
    <div id="icon">‚õÖ</div>
    <div id="weather" class="value">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <canvas id="tempChart"></canvas>
    <div id="forecast" class="forecast-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞...</div>
  </div>

  <iframe class="map" src="https://embed.windy.com/embed2.html?lat=53.9&lon=27.5667&detailLat=53.9&detailLon=27.5667&width=650&height=450&zoom=6&level=surface&overlay=rain&menu=&message=true&marker=true&calendar=now&pressure=true&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1"></iframe>

  <footer>–ú–∏–ª–∞–Ω—ã –∑–¥–µ—Å—å –Ω–µ—Ç—É, —Å–ø–∏ —Å–ø–æ–∫–æ–π–Ω–æ</footer>

  <script>
    function updateTime() {
      const now = new Date();
      document.getElementById("time").textContent = now.toLocaleTimeString("ru-RU");
    }
    setInterval(updateTime, 1000);
    updateTime();

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        // –ü–æ–º–µ–Ω—è—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞—Ä—Ç—ã
        document.querySelector("iframe.map").src =
          `https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&detailLat=${lat}&detailLon=${lon}&width=650&height=450&zoom=6&level=surface&overlay=rain&menu=&message=true&marker=true&calendar=now&pressure=true&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1`;

        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,weathercode&timezone=auto`)
          .then(res => res.json())
          .then(data => {
            const weather = data.current_weather;
            document.getElementById("weather").textContent = `${weather.temperature}¬∞C, –≤–µ—Ç–µ—Ä: ${weather.windspeed} –∫–º/—á`;

            const code = weather.weathercode;
            const icon = document.getElementById("icon");
            if (code < 2) icon.textContent = "‚òÄÔ∏è";
            else if (code < 3) icon.textContent = "‚õÖ";
            else if (code < 60) icon.textContent = "‚òÅÔ∏è";
            else if (code < 70) icon.textContent = "üåßÔ∏è";
            else icon.textContent = "‚ùÑÔ∏è";

            if (code >= 60 && code < 70) {
              document.body.classList.add("shake");
              setTimeout(() => document.body.classList.remove("shake"), 5000);
            }

            if (code >= 70 && code < 80) {
              for (let i = 0; i < 20; i++) {
                let flake = document.createElement("div");
                flake.className = "snowflake";
                flake.textContent = "‚ùÑÔ∏è";
                flake.style.left = Math.random() * 100 + "vw";
                flake.style.animationDuration = (3 + Math.random() * 5) + "s";
                document.body.appendChild(flake);
              }
            }

            const temps = data.hourly.temperature_2m.slice(0, 24);
            const hours = data.hourly.time.slice(0, 24).map(t => new Date(t).getHours() + ":00");

            new Chart(document.getElementById("tempChart"), {
              type: 'line',
              data: {
                labels: hours,
                datasets: [{
                  label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ¬∞C',
                  data: temps,
                  borderColor: '#ffcc00',
                  backgroundColor: 'rgba(255,204,0,0.2)',
                  tension: 0.3,
                  pointRadius: 3,
                }]
              },
              options: {
                plugins: { legend: { display: false }},
                scales: {
                  x: { ticks: { color: '#fff' }},
                  y: { ticks: { color: '#fff' }}
                }
              }
            });

            const maxTemp = Math.max(...temps);
            const minTemp = Math.min(...temps);
            let forecastText = `–°–µ–≥–æ–¥–Ω—è –æ—Ç ${minTemp.toFixed(1)}¬∞C –¥–æ ${maxTemp.toFixed(1)}¬∞C. `;
            if (code < 2) forecastText += "–Ø—Å–Ω–æ.";
            else if (code < 3) forecastText += "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å.";
            else if (code < 60) forecastText += "–û–±–ª–∞—á–Ω–æ.";
            else if (code < 70) forecastText += "–î–æ–∂–¥—å.";
            else forecastText += "–°–Ω–µ–≥.";
            document.getElementById("forecast").textContent = forecastText;
          });
      });
    }

    window.addEventListener('load', () => {
      const msg = new SpeechSynthesisUtterance("–ú–∏–ª–∞–Ω—ã –∑–¥–µ—Å—å –Ω–µ—Ç—É. –°–ø–∏ —Å–ø–æ–∫–æ–π–Ω–æ.");
      msg.lang = "ru-RU";
      msg.volume = 0.5;
      speechSynthesis.speak(msg);
    });
  </script>
</body>
</html>
